<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <head>
    <title>Listado de Comidas</title>
    <link rel="stylesheet" th:href="@{/css/main.css}" />
    <link rel="stylesheet" th:href="@{/css/font.css}" />
    <link rel="stylesheet" th:href="@{/css/default.css}" />
    <link rel="stylesheet" th:href="@{/bootstrap/bootstrap.css}" />
    <link rel="stylesheet" th:href="@{/fontawesome/css/fontawesome.min.css}" />
    <link rel="stylesheet" th:href="@{/fontawesome/css/all.min.css}" />
    <link rel="stylesheet" th:href="@{/fontawesome/css/solid.min.css}" />
    <link rel="stylesheet" th:href="@{/fontawesome/css/brands.min.css}" />
  </head>
  <body>
    <div class="container-web">
      <header class="container-fluid bg-orange">
        <div class="container py-4">
          <div class="row">
            <div class="col-md-6">
              <a href="/home">
                <img
                th:src="@{/images/logo_v2.png}"
                style="width: 200px"
                alt=""
              />
               </a>
            </div>
            <div class="col-md-6 d-flex justify-content-end align-items-center">
              <div class="">
                <a th:href="@{/logout}" class="text-white px-3">Logout</a>
                <a sec:authorize="hasRole('ADMINISTRADOR')" href="/admin" class="text-white border px-3 py-2"
                  >Intranet</a
                >
              </div>
            </div>
          </div>
        </div>
      </header>
      <main>
        <div class="container">
          <div class="row py-5">
            <h3 class="text-center hr-title">❝ Receta para Desayunos ❞</h3>
          </div>
          <div class="row mb-5 p-0">
            <div class="col-md-3 ps-0 pe-3">
              <div class="p-3  bg-white">
                <h4 class="fw-bold pb-2">Categorias</h4>
                <ul class="list-unstyled" id="categoriasList">

                </ul>
              </div>
            </div>
            <div class="col-md-9 p-0">
              <div class="col">
                <div class="mb-2 d-flex">
                  <input type="text" class="form-control" id="search" placeholder="¿En qué estás pensando?, busca una receta...">
                  <button class="btn"><i class="fa fa-search"></i></button>
                </div>
                <section class="border bg-white p-5">
                  <div id="comidasContainer"></div>
                  <!-- <a href="#" class="mb-3 d-flex" target="_blank">
                    <div class="divider-wrapper d-flex">
                      <div
                        class="divider-image"
                        style="background-image: url('/images/food.jpg')"
                      ></div>
                      <div class="divider-content ps-3">
                        <div class="d-flex">
                          <h4 class="pe-2 text-orange border-end">
                            <strong>Lorem ipsum</strong>
                          </h4>
                          <h4 class="ps-2"><i class="fa fa-star"></i> 4.3</h4>
                        </div>
                        <div><p class="mb-1 p-0 text-success"><strong>CATEGORIA</strong> | TIPO</p></div>
                        <p class="text-secondary">
                          Lorem ipsum dolor sit amet consectetur, adipisicing elit. Facilis animi, dolore excepturi exercitationem recusandae incidunt, ipsam libero assumenda iusto corrupti provident, ratione consequatur placeat illo eius consectetur nisi dolorum facere.
                          Dignissimos, ullam natus! Accusamus qui suscipit atque ullam, quis alias natus similique non porro a nam veniam facere, ea officia eius sunt aspernatur ratione iure ab magni debitis, in doloribus?
                          Molestiae ipsam explicabo hic. Architecto nesciunt maxime tempora qui delectus perferendis aut quas tenetur, ab, doloremque atque praesentium quasi! Consectetur, ut exercitationem earum veritatis eos necessitatibus eveniet ratione alias qui.
                        </p>
                      </div>
                    </div>
                  </a>                   -->
                </section>
              </div>
            </div>
          </div>
        </div>
      </main>
      <footer>
        <div class="container">
          <div class="row">
            <div class="col">
              <p class="text-center text-secondary">
                © 2024. All rights reserved. Created by
                <a
                  class="text-orange"
                  href="https://unsm.edu.pe/facultad/ingenieria-de-sistemas/" target="_blank"
                  >@fisi</a>
              </p>
            </div>
          </div>
      </footer>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
      fetch('/categoria/find/all')
        .then(response => response.json()) // Convertir la respuesta a JSON
        .then(data => {
          // Iterar sobre las categorías y construir los <li> correspondientes
          data.forEach(categoria => {
            // Crear un nuevo elemento <li> con un <a> dentro
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = `/home/comidas/categoria/${categoria.nombre}`; // Enlace de ejemplo, ajusta según tus necesidades
            a.className = 'p-2 mb-2 border-start border-4 d-flex fs-6 text-orange';
            a.textContent = categoria.nombre; // Asumiendo que 'nombre' es el campo deseado

            // Agregar el <a> al <li> y el <li> a la lista de categorías
            li.appendChild(a);
            categoriasList.appendChild(li);
          });
        })
        .catch(error => console.error('Error al obtener las categorías:', error));


        const url = window.location.pathname;
        const categoriaComida = url.split('/').pop();

        const titulo = document.querySelector('.hr-title');
        titulo.textContent = categoriaComida;

        console.log(categoriaComida)

        fetch(`/comida/listar/categoria/${categoriaComida}`)
            .then(response => response.json())
            .then(comidas => {
                const container = document.getElementById('comidasContainer');
                comidas.forEach(comida => {
                    const comidaElement = document.createElement('a');
                    comidaElement.href = `/home/comidas/comida/${comida.id}`;
                    comidaElement.className = 'mb-3 d-flex';
                    comidaElement.target = '_blank';
                    comidaElement.innerHTML = `

                        <div class="divider-wrapper d-flex">
                            <div class="divider-image" style="background-image: url('data:image/jpeg;base64,${comida.imagen}')"></div>
                            <div class="divider-content ps-3">
                                <div class="d-flex">
                                    <h4 class="pe-2 text-orange border-end">
                                        <strong>${comida.nombre}</strong>
                                    </h4>
                                    <h4 class="ps-2"><i class="fa fa-star"></i> ${comida.calificacion}</h4>
                                </div>
                                <div><p class="mb-1 p-0 text-success"><strong>${comida.categoria.nombre}</strong> | ${comida.tipo}</p></div>
                                <p class="text-secondary">
                                    ${comida.preparacion}
                                </p>
                            </div>
                        </div>

                    `;
                    container.appendChild(comidaElement);
                });
            })
            .catch(error => console.error('Error fetching comidas:', error));
          });
    </script>
  </body>
</html>
